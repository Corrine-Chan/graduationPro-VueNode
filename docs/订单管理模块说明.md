# 订单管理模块说明

## 功能概述

订单管理模块用于管理充电站的充电订单，包括订单查询、详情查看、删除等功能。

## 功能特性

### 1. 订单列表

- **多条件查询**
  - 订单号查询
  - 订单状态筛选（全部/进行中/已完成/异常）
  - 设备编号查询
  - 站点名称查询
  - 日期范围查询

- **分页显示**
  - 支持每页10/20/30/40条数据
  - 显示总条数和页码

- **批量操作**
  - 批量删除订单
  - 导出订单数据到Excel

### 2. 订单详情

- 订单基本信息（订单号、设备编号、订单日期等）
- 充电信息（充电量、充电时长、设备类型等）
- 费用明细（电费、服务费、停车费）
- 站点信息（站点名称、所属城市）
- 人员信息（负责人、维保人员）
- 订单状态和备注

### 3. 订单状态

- **进行中（2）**: 订单正在充电中
- **已完成（3）**: 订单已完成充电
- **异常（4）**: 订单出现异常，需要人工处理

## 数据库表结构

### charging_orders 表

```sql
- order_no: 订单号（唯一）
- equipment_no: 设备编号
- station_id: 充电站ID
- station_name: 充电站名称
- city: 所属城市
- order_date: 订单日期
- start_time: 开始时间
- end_time: 结束时间
- charging_duration: 充电时长（小时）
- energy_consumed: 充电量（kWh）
- equipment_type: 充电设备类型
- total_amount: 订单总金额（元）
- electricity_fee: 电费（元）
- service_fee: 服务费（元）
- parking_fee: 停车费（元）
- payment_method: 支付方式
- status: 订单状态
- manager_name: 负责人姓名
- manager_tel: 负责人电话
- maintenance_name: 维保人员姓名
- maintenance_tel: 维保人员电话
- charge_info: 收费信息
- remarks: 备注
```

## API 接口

### 1. 获取订单列表

- **接口**: `POST /api/order/list`
- **参数**:
  ```json
  {
    "orderNo": "订单号（可选）",
    "status": "订单状态（1-全部，2-进行中，3-已完成，4-异常）",
    "no": "设备编号（可选）",
    "name": "站点名称（可选）",
    "startDate": "开始日期（可选）",
    "endDate": "结束日期（可选）",
    "page": 1,
    "pageSize": 10
  }
  ```
- **返回**:
  ```json
  {
    "code": 200,
    "success": true,
    "data": {
      "list": [...],
      "total": 100
    }
  }
  ```

### 2. 获取订单详情

- **接口**: `POST /api/order/detail`
- **参数**:
  ```json
  {
    "orderNo": "订单号"
  }
  ```

### 3. 批量删除订单

- **接口**: `POST /api/order/batchDelete`
- **参数**:
  ```json
  {
    "order": ["订单号1", "订单号2", ...]
  }
  ```

### 4. 单个删除订单

- **接口**: `POST /api/order/singleDelete`
- **参数**:
  ```json
  {
    "orderNo": "订单号"
  }
  ```

### 5. 获取城市列表

- **接口**: `GET /api/order/cityList`

## 使用说明

### 1. 初始化数据库

首先执行数据库脚本创建表结构：

```bash
# 在MySQL中执行
source database/schema.sql
```

### 2. 生成测试数据

运行订单数据生成脚本：

```bash
# Windows
cd backend/scripts
initOrderData.bat

# 或者直接运行
cd backend
node scripts/generateOrderData.js
```

### 3. 启动服务

```bash
# 启动后端服务
cd backend
npm start

# 启动前端服务
cd frontend
npm run dev
```

### 4. 访问订单管理

- 登录系统后，点击左侧菜单"运营管理" -> "订单管理"
- 可以进行订单查询、查看详情、删除等操作

## 注意事项

1. **权限控制**: 所有订单接口都需要登录认证
2. **数据安全**: 删除操作会有二次确认提示
3. **数据导出**: 导出功能只导出当前勾选的订单数据
4. **订单状态**:
   - 进行中的订单没有结束时间和充电量
   - 已完成的订单包含完整的充电信息
   - 异常订单需要人工处理

## 开发说明

### 前端文件

- `frontend/src/views/operations/Orders.vue` - 订单列表页面
- `frontend/src/views/operations/Detail.vue` - 订单详情页面
- `frontend/src/api/operation.ts` - 订单API接口
- `frontend/src/store/order.ts` - 订单状态管理

### 后端文件

- `backend/src/routes/order.js` - 订单路由
- `backend/src/controllers/orderController.js` - 订单控制器
- `backend/scripts/generateOrderData.js` - 订单数据生成脚本

## 常见问题

### Q1: 订单列表为空？

A: 请先运行 `generateOrderData.js` 脚本生成测试数据

### Q2: 无法删除订单？

A: 检查是否有登录权限，以及数据库连接是否正常

### Q3: 订单详情显示"未找到订单信息"？

A: 确保从订单列表页面点击"详情"按钮进入，或检查订单号是否正确

### Q4: 导出Excel失败？

A: 确保已勾选要导出的订单数据

## 后续优化建议

1. 添加订单编辑功能
2. 添加订单统计图表
3. 支持订单导入功能
4. 添加订单状态变更记录
5. 支持更多的查询条件（如金额范围、充电量范围等）
