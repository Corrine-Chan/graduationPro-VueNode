# 数据库表名说明

## 📋 问题说明

在开发过程中，由于表名命名不一致，导致数据库中存在两个相似的表：

1. **`charging_piles`**（复数）- 旧表
2. **`charging_pile`**（单数）- 新表

## 🔍 表的区别

### charging_piles（旧表）

- **创建时间**：早期开发阶段
- **字段结构**：
  - `pile_code` - 充电桩编号
  - `station_id` - 充电站ID（外键关联）
  - `status` - 状态（使用字符串：'charging', 'idle', 'fault'等）
- **数据量**：约100条
- **使用位置**：
  - `dashboardController.js`（已更新）

### charging_pile（新表）

- **创建时间**：2026-02-02（充电桩管理模块开发时）
- **字段结构**：
  - `pile_id` - 充电桩ID
  - `station_id` - 所属充电站ID（字符串，如'VXZ10001'）
  - `station_name` - 所属充电站名称
  - `voltage` - 电压
  - `current` - 电流
  - `power` - 功率
  - `temperature` - 温度
  - `status` - 状态（使用数字：1-空闲, 2-充电中, 6-故障等）
  - `charge_percent` - 充电进度
- **数据量**：47条（3个充电站）
- **使用位置**：
  - `stationController.js` - getPileList方法
  - `dashboardController.js`（已更新）

## ✅ 解决方案

我们已经统一使用 **`charging_pile`**（单数）表，原因如下：

1. **更完整的字段结构**：包含电压、电流、功率、温度等详细信息
2. **更清晰的关联关系**：直接存储充电站名称，便于查询
3. **更灵活的状态管理**：使用数字状态码，便于扩展
4. **与前端mock数据一致**：前端mock使用的就是这种结构

## 🔧 已完成的更新

### 1. 后端代码更新

**文件**：`backend/src/controllers/dashboardController.js`

**更新内容**：

- 将所有 `FROM charging_piles` 改为 `FROM charging_pile`
- 将状态判断从字符串改为数字：
  - `status = 'charging'` → `status = 2`
  - `status = 'idle'` → `status = 1`
  - `status = 'fault'` → `status = 6`

### 2. 数据库表统一

**当前使用的表**：

- ✅ `charging_pile` - 充电桩详情表（新表，正在使用）
- ✅ `pile_usage_record` - 充电桩使用记录表

**待删除的表**：

- ❌ `charging_piles` - 旧表（可以删除）

## 🗑️ 清理旧表

如果你确认不再需要 `charging_piles` 表中的数据，可以执行以下操作：

### 方式一：使用SQL脚本

```bash
mysql -u root -p charging_station < database\cleanup_old_tables.sql
```

### 方式二：在Navicat中手动删除

1. 右键点击 `charging_piles` 表
2. 选择"删除表"
3. 确认删除

### 方式三：在MySQL命令行中执行

```sql
USE charging_station;
DROP TABLE IF EXISTS charging_piles;
```

## ⚠️ 注意事项

### 删除前的检查

在删除 `charging_piles` 表之前，请确认：

1. **数据备份**：如果表中有重要数据，先备份

   ```sql
   CREATE TABLE charging_piles_backup AS SELECT * FROM charging_piles;
   ```

2. **代码检查**：确认没有其他代码引用这个表
   - 已检查 `dashboardController.js` ✅
   - 已检查 `stationController.js` ✅

3. **功能测试**：删除后测试以下功能是否正常
   - 数据看板的雷达图
   - 数据看板的设备统计
   - 充电桩管理页面

## 📊 状态码对照表

为了方便理解，这里列出新表的状态码：

| 状态码 | 状态名称  | 旧表对应值          |
| ------ | --------- | ------------------- |
| 1      | 空闲中    | 'idle'              |
| 2      | 充电中    | 'charging'          |
| 3      | 连接中    | 'connecting'        |
| 4      | 排队中    | 'queuing'           |
| 5      | 已预约    | 'reserved'          |
| 6      | 故障/离线 | 'fault' / 'offline' |

## 🎯 推荐操作步骤

1. **测试新表功能**
   - 访问充电桩管理页面
   - 检查数据看板的雷达图和设备统计
   - 确认所有功能正常

2. **备份旧表数据**（如果需要）

   ```sql
   CREATE TABLE charging_piles_backup AS SELECT * FROM charging_piles;
   ```

3. **删除旧表**

   ```sql
   DROP TABLE IF EXISTS charging_piles;
   ```

4. **验证删除**
   ```sql
   SHOW TABLES LIKE 'charging_pile%';
   ```
   应该只显示 `charging_pile` 表

## 📝 总结

- **当前使用**：`charging_pile`（单数）
- **已废弃**：`charging_piles`（复数）
- **建议操作**：删除旧表 `charging_piles`
- **影响范围**：无（已更新所有引用）

---

**最后更新**：2026-02-02  
**状态**：✅ 已解决
