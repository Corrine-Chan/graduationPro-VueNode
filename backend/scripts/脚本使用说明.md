# 脚本使用说明（中文版）

## 📋 脚本文件说明

### 1. generateDailyRevenue.js - 生成每日营收数据

**文件作用**: 自动为所有充电站生成指定日期的营收统计数据

**主要功能**:

- 读取数据库中的充电站信息
- 为每个充电站随机生成营收数据（电费、停车费、服务费、会员储值金等）
- 自动计算单日总收入
- 插入到营收统计表中
- 检查是否已有数据，避免重复

**使用方法**:

```bash
# 生成今天的数据
node scripts/generateDailyRevenue.js

# 生成指定日期的数据（例如2026年2月4日）
node scripts/generateDailyRevenue.js 2026-02-04
```

**适用场景**:

- ✅ 每天需要新的演示数据
- ✅ 第一次使用系统，需要初始化数据
- ✅ 测试营收统计功能

---

### 2. updateRevenueDate.js - 更新数据日期

**文件作用**: 将数据库中所有营收数据的日期更新为今天

**主要功能**:

- 查看当前数据的日期
- 将所有数据的日期字段更新为今天
- 不修改营收金额，只改日期
- 显示更新前后的对比

**使用方法**:

```bash
node scripts/updateRevenueDate.js
```

**适用场景**:

- ✅ 数据库有旧数据，想快速显示为今天
- ✅ 演示时需要让数据看起来是最新的
- ✅ 不想重新生成数据，只改日期

---

### 3. checkRevenueData.js - 查看数据概况

**文件作用**: 查看数据库中营收数据的统计信息

**主要功能**:

- 显示每个日期有多少条数据
- 显示最新的数据日期
- 对比今天日期，提示是否需要更新
- 不修改任何数据，只查看

**使用方法**:

```bash
node scripts/checkRevenueData.js
```

**适用场景**:

- ✅ 检查数据库中是否有数据
- ✅ 查看最新数据是哪天的
- ✅ 排查页面"无数据"问题
- ✅ 确认脚本是否执行成功

---

### 4. generatePassword.js - 生成加密密码

**文件作用**: 为用户生成加密后的密码（用于用户管理）

**使用方法**:

```bash
node scripts/generatePassword.js 123456
```

---

## 🎯 使用流程

### 第一次使用系统

```bash
# 步骤1: 进入后端目录
cd backend

# 步骤2: 检查营收数据
node scripts/checkRevenueData.js

# 步骤3: 检查充电桩使用记录
node scripts/checkPileRecords.js

# 步骤4: 如果没有营收数据，生成今天的数据
node scripts/generateDailyRevenue.js

# 步骤5: 如果使用记录不是今天的，更新日期
node scripts/updatePileRecordDate.js

# 步骤6: 启动后端服务
npm run dev

# 步骤7: 打开前端页面，查看营收统计和充电桩管理
```

### 每天演示前

```bash
# 更新营收数据日期
node scripts/updateRevenueDate.js

# 更新充电桩使用记录日期
node scripts/updatePileRecordDate.js
```

---

## 💡 常见问题解答

### Q1: 页面显示"无数据"怎么办？

**答**:

1. 运行 `node scripts/checkRevenueData.js` 检查数据
2. 如果没有数据，运行 `node scripts/generateDailyRevenue.js`
3. 刷新前端页面

### Q2: 脚本提示"已存在数据"怎么办？

**答**:

- 如果想更新日期：运行 `node scripts/updateRevenueDate.js`
- 如果想删除重新生成：手动在数据库中删除数据后再运行

### Q3: 脚本提示"没有找到充电站数据"？

**答**:

1. 检查数据库表 `station_monitor` 是否存在
2. 检查表中是否有充电站数据
3. 如果没有，运行 `database/schema.sql` 初始化数据

### Q4: 数据库连接失败？

**答**:

1. 打开脚本文件
2. 找到数据库配置部分（host, user, password）
3. 修改为你的实际数据库信息
4. 默认密码是 `021126`

### Q5: 每天都要手动运行吗？

**答**:

- **演示环境**: 是的，需要手动运行
- **生产环境**: 应该配置定时任务自动运行

---

## ⚙️ 数据库配置

所有脚本都需要连接数据库，配置信息在每个脚本文件的开头：

```javascript
const pool = mysql.createPool({
  host: "localhost", // 数据库地址
  user: "root", // 数据库用户名
  password: "021126", // 数据库密码 ⚠️ 请修改为你的密码
  database: "charging_station", // 数据库名称
});
```

**请确保**:

- ✅ 数据库 `charging_station` 已创建
- ✅ 表 `station_monitor` 和 `station_revenue` 已创建
- ✅ `station_monitor` 表中有充电站数据

---

## 📊 生成的数据说明

每个充电站会生成以下数据：

| 字段       | 说明         | 数值范围      |
| ---------- | ------------ | ------------- |
| 电费营收   | 充电电费收入 | 7000-9000元   |
| 停车费营收 | 停车费收入   | 2500-3000元   |
| 服务费营收 | 服务费收入   | 6500-7000元   |
| 会员储值金 | 会员充值金额 | 3000-3500元   |
| 单日总收入 | 以上四项之和 | 自动计算      |
| 月度总收入 | 本月累计收入 | 4500-5500万元 |
| 日增长率   | 日环比增长率 | -5% 到 +5%    |
| 月增长率   | 月环比增长率 | -5% 到 +5%    |

**注意**: 这些是模拟数据，真实环境应该从订单表统计实际营收。

---

## 🔐 安全提示

⚠️ **重要提醒**:

1. 脚本中包含数据库密码，不要提交到公开仓库
2. 生产环境应该使用环境变量管理密码
3. 定期更换数据库密码
4. 不要在生产环境使用这些模拟数据

---

## 📞 需要帮助？

如果遇到问题：

1. 查看本文档的"常见问题解答"部分
2. 查看 `docs/营收数据管理说明.md` 了解更多细节
3. 检查数据库连接和表结构
4. 查看脚本运行时的错误提示

---

**创建日期**: 2026-02-03  
**最后更新**: 2026-02-03

---

## 充电桩记录管理

### 4. checkPileRecords.js - 查看充电桩使用记录

**文件作用**: 查看数据库中充电桩使用记录的统计信息

**主要功能**:

- 显示每个日期有多少条使用记录
- 显示最新的记录日期
- 对比今天日期，提示是否需要更新
- 不修改任何数据，只查看

**使用方法**:

```bash
node scripts/checkPileRecords.js
```

**输出示例**:

```
📊 充电桩使用记录统计：
================
  2026-02-03: 12 条记录
================
总计: 1 个日期

📅 最新记录日期: 2026-02-03
📅 今天日期: 2026-02-03
✅ 记录是最新的（今天）
```

**适用场景**:

- ✅ 检查数据库中是否有充电桩使用记录
- ✅ 查看最新记录是哪天的
- ✅ 排查页面"使用记录为空"问题
- ✅ 确认脚本是否执行成功

---

### 5. updatePileRecordDate.js - 更新使用记录日期

**文件作用**: 将数据库中所有充电桩使用记录的日期更新为今天

**主要功能**:

- 查看当前记录的日期
- 将所有记录的日期字段更新为今天
- 不修改记录内容，只改日期
- 显示更新前后的对比

**使用方法**:

```bash
node scripts/updatePileRecordDate.js
```

**适用场景**:

- ✅ 数据库有旧记录，想快速显示为今天
- ✅ 演示时需要让记录看起来是最新的
- ✅ 不想重新生成记录，只改日期

---

## 📝 补充说明

### 关于日期问题

系统中有两个地方会因为日期问题导致数据不显示：

1. **营收统计模块** - 查询 `station_revenue` 表的最新日期数据
2. **充电桩使用记录** - 查询 `pile_usage_record` 表的最新日期记录

如果页面显示"无数据"或"无记录"，请分别检查和更新这两个表的数据日期。

### 快速修复命令

```bash
# 一次性更新所有数据日期
cd backend
node scripts/updateRevenueDate.js
node scripts/updatePileRecordDate.js
```
